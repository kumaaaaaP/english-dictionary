<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>English Dictionary</title>
    <style>
        :root { --primary-color: #007bff; --chapter-color: #6c757d; --bg-color: #f4f7f9; }
        body { font-family: sans-serif; background-color: var(--bg-color); margin: 0; padding: 20px; display: flex; flex-direction: column; align-items: center; }
        .container { width: 100%; max-width: 800px; }
        h1 { color: var(--primary-color); text-align: center; border-bottom: 3px solid var(--primary-color); padding-bottom: 10px; }
        
        .toc { background: white; padding: 15px; border-radius: 10px; margin-bottom: 25px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        .toc-links { display: flex; flex-wrap: wrap; gap: 8px; list-style: none; padding: 0; }
        .toc-links a { text-decoration: none; color: var(--primary-color); font-size: 0.8rem; background: #eef2f7; padding: 5px 10px; border-radius: 15px; }

        .search-box { width: 100%; padding: 15px; font-size: 18px; border: 2px solid #ddd; border-radius: 10px; margin-bottom: 20px; box-sizing: border-box; }
        
        .word-list { list-style: none; padding: 0; }
        .chapter-header { background: var(--chapter-color); color: white; padding: 10px 15px; margin: 30px 0 10px 0; border-radius: 5px; font-weight: bold; }
        .word-item { background: white; margin-bottom: 8px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.05); animation: fadeIn 0.3s ease-in; }
        .word-item a { display: flex; padding: 12px 20px; text-decoration: none; color: #333; }
        .word-id { font-weight: bold; color: var(--primary-color); min-width: 75px; }
        .sub-word { margin-left: 25px; border-left: 4px solid #ccd5ae; }
        
        #sentinel { height: 50px; display: flex; align-items: center; justify-content: center; color: #888; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>
<div class="container">
    <h1>英単語辞書</h1>
    <nav class="toc"><ul class="toc-links"><li><a href="#" onclick="jumpToChapter(1); return false;">【速読英単語】第1章：人間と動物の違い</a></li><li><a href="#" onclick="jumpToChapter(341); return false;">【速読英単語】第13章：暴力はなぜ起きる</a></li><li><a href="#" onclick="jumpToChapter(369); return false;">【速読英単語】第14章：謙虚さが教えてくれること⑴</a></li><li><a href="#" onclick="jumpToChapter(403); return false;">【速読英単語】第15章：謙虚さが教えてくれること⑵</a></li><li><a href="#" onclick="jumpToChapter(424); return false;">【速読英単語】第16章：謙虚さが教えてくれること⑶</a></li><li><a href="#" onclick="jumpToChapter(441); return false;">【速読英単語】第17章：人種差別を排除するには⑴</a></li><li><a href="#" onclick="jumpToChapter(473); return false;">【速読英単語】第18章：人種差別を排除するには⑵</a></li><li><a href="#" onclick="jumpToChapter(502); return false;">【速読英単語】第19章：受刑者に対する実験の是非⑴</a></li><li><a href="#" onclick="jumpToChapter(523); return false;">【速読英単語】第20章：受刑者に対する実験の是非⑵</a></li><li><a href="#" onclick="jumpToChapter(558); return false;">【速読英単語】第21章：ホーソン効果</a></li><li><a href="#" onclick="jumpToChapter(579); return false;">【速読英単語】第22章：ジャンクフードから見る経済格差⑴</a></li><li><a href="#" onclick="jumpToChapter(594); return false;">【速読英単語】第23章：ジャンクフードから見る経済格差⑵</a></li><li><a href="#" onclick="jumpToChapter(617); return false;">【速読英単語】第24章：ジャンクフードから見る経済格差⑶</a></li><li><a href="#" onclick="jumpToChapter(629); return false;">【速読英単語】第25章：ジャンクフードから見る経済格差⑷</a></li><li><a href="#" onclick="jumpToChapter(646); return false;">【速読英単語】第26章：適切な塩の摂取量とは⑴</a></li><li><a href="#" onclick="jumpToChapter(671); return false;">【速読英単語】第27章：適切な塩の摂取量とは⑵</a></li><li><a href="#" onclick="jumpToChapter(700); return false;">【速読英単語】第28章：健康によい運動量の本当の目安⑴</a></li><li><a href="#" onclick="jumpToChapter(732); return false;">【速読英単語】第29章：健康によい運動量の本当の目安⑵</a></li><li><a href="#" onclick="jumpToChapter(743); return false;">【速読英単語】第30章：健康によい運動量の本当の目安⑶</a></li><li><a href="#" onclick="jumpToChapter(763); return false;">【速読英単語】第31章：プラスチックが健康に与える影響⑴</a></li><li><a href="#" onclick="jumpToChapter(790); return false;">【速読英単語】第32章：プラスチックが健康に与える影響⑵</a></li><li><a href="#" onclick="jumpToChapter(826); return false;">【速読英単語】第33章：プラスチックが健康に与える影響⑶</a></li><li><a href="#" onclick="jumpToChapter(4374); return false;">【東進上級英単語1000】ステージ5</a></li><li><a href="#" onclick="jumpToChapter(4474); return false;">【東進上級英単語1000】ステージ6</a></li><li><a href="#" onclick="jumpToChapter(4574); return false;">【東進上級英単語1000】ステージ7</a></li><li><a href="#" onclick="jumpToChapter(4674); return false;">【東進上級英単語1000】ステージ8</a></li><li><a href="#" onclick="jumpToChapter(4774); return false;">【東進上級英単語1000】ステージ9</a></li><li><a href="#" onclick="jumpToChapter(4874); return false;">【東進上級英単語1000】ステージ10</a></li></ul></nav>
    <input type="text" id="searchInput" class="search-box" placeholder="検索..." onkeyup="handleSearch()">
    <ul class="word-list" id="wordList"></ul>
    <div id="sentinel">さらに読み込み中...</div>
</div>

<script>
    let allData = [];
    let filteredData = [];
    let currentIndex = 0;
    const PAGE_SIZE = 40;
    const wordList = document.getElementById('wordList');
    const sentinel = document.getElementById('sentinel');
    let currentChapterInView = null;

    // 1. データの初回取得 (Fetch)
    async function loadInitialData() {
        try {
            const response = await fetch('word_data.json');
            allData = await response.json();
            filteredData = allData;
            initObserver();
        } catch (e) { console.error("データ読み込み失敗", e); }
    }

    // 2. リストへの追加描画
    function renderNextPage() {
        const nextSet = filteredData.slice(currentIndex, currentIndex + PAGE_SIZE);
        nextSet.forEach(word => {
            // 章ヘッダーの挿入
            if (word.chapter_id !== currentChapterInView && !document.getElementById('search-active')) {
                const header = document.createElement('li');
                header.className = 'chapter-header';
                header.id = `chapter-${word.chapter_id}`;
                header.textContent = word.chapter_title;
                wordList.appendChild(header);
                currentChapterInView = word.chapter_id;
            }

            const li = document.createElement('li');
            li.className = word.is_sub ? 'word-item sub-word' : 'word-item';
            li.innerHTML = `<a href="data/${word.file}">
                <span class="word-id">${word.id}</span>
                <span class="word-name">${word.name}</span>
            </a>`;
            wordList.appendChild(li);
        });
        currentIndex += PAGE_SIZE;
        if (currentIndex >= filteredData.length) sentinel.style.display = 'none';
    }

    // 3. Intersection Observer (交差監視)
    function initObserver() {
        const observer = new IntersectionObserver((entries) => {
            if (entries[0].isIntersecting && currentIndex < filteredData.length) {
                renderNextPage();
            }
        }, { rootMargin: '200px' });
        observer.observe(sentinel);
    }

    // 4. 検索機能
    function handleSearch() {
        const query = document.getElementById('searchInput').value.toLowerCase();
        currentIndex = 0;
        wordList.innerHTML = query ? '<div id="search-active"></div>' : ''; 
        currentChapterInView = null;
        sentinel.style.display = 'block';
        
        filteredData = allData.filter(w => 
            w.name.toLowerCase().includes(query) || w.id.toLowerCase().includes(query)
        );
        renderNextPage();
    }

    // 5. 章へのジャンプ
    function jumpToChapter(id) {
        const query = document.getElementById('searchInput');
        if (query.value) { query.value = ''; handleSearch(); }
        
        // 全データをその章から再描画
        wordList.innerHTML = '';
        const startIdx = allData.findIndex(w => w.chapter_id === id);
        currentIndex = startIdx;
        currentChapterInView = null;
        renderNextPage();
        window.scrollTo(0, 0);
    }

    loadInitialData();
</script>
</body>
</html>